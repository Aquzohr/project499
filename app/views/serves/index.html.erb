<a class="d-block p-5 text-center text-white bg-primary b4b full-width">SERVE MENU</a>

<br>
<h2><span class="glyphicon glyphicon-user"></span> CHECK-IN / CHECK-OUT</h2>
<hr>

<%= bootstrap_form_for(@serve) do |f| %>

  <div class="row">
    <div class="col-8 ">
      <%= f.collection_select :member_id, Member.all, :id, :codeAndFullname, prompt: true %>
    </div>
    <div class="col-4 cell-center">
      <%= f.submit 'CHECN-IN', class: "btn btn-success btn-block" %>
    </div>
  </div>

  <%= f.hidden_field :checkin_time, value: Time.now.strftime("%H:%M:%S") %>
  <%= f.hidden_field :date, value: Time.now %>
  <%= f.hidden_field :staff_id, value: current_user.staff.id %>


<% end %>

<hr>
<br>

<% if notice %>
  <div class="alert alert-success alert-dismissible fade show" role="alert">
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
    <%= notice %>
  </div>
<% end %>


<% if  @lastCheckin %>

  <div class="card card-default">
    <div class="card-header">
      LAST CHECK-IN
    </div>
    <div class="card-block">
      <h4 class="card-title">Fullname : <%= @lastCheckin.member.user.firstname %> <%= @lastCheckin.member.user.lastname %></h4>
      <p class="card-text" ><h4> Register Date : <%= @lastCheckin.member.start_date %> </h4></p>
          
      <% unless @lastCheckin.member.end_date.blank? %>
          <% if Time.now.to_date < @lastCheckin.member.end_date %>
            <p class="card-text"><h4 class="text-success">Exp Date : <%= @lastCheckin.member.end_date %> </h4></p>
          <% else %>
            <p class="card-text"><h4 class="text-danger">Exp Date : <%= @lastCheckin.member.end_date %> </h4></p>
          <% end %>
        <% else %>
          <p class="card-text"><h4>Exp Date : ไม่ระบุวันหมดอายุ </h4></p>
      <% end %>

    </div>
  </div>

<% end %>



<div class="col-md-12 text-right"><h3><kbd>TODAY: <%= Time.now.to_date %></kbd></h3></div>
<table data-toggle="table"
       data-pagination="true"
       data-pagination-loop ="false" >
  <thead>
    <th>NO.</th>
    <th>Code</th>
    <th>Fullname</th>
    <th>Checkin Time</th>
    <th data-align="center" data-width="100px">Action</th>
  </thead>

  <tbody>
    <% @serves.each_with_index do |s,i| %>
      <% if s.member %>
        <tr>
          <td><%= i+1 %></td>
          <td><%= s.member.member_code %></td>
          <td><%= s.member.user.firstname %> <%= s.member.user.lastname %></td>
          <td><%= s.checkin_time %></td>
          <td><%= link_to 'Checkout', s, method: :patch, data: { confirm: 'Are you sure?' }, class: "btn btn-warning btn-block" %></td>
        </tr>
      <% end %>
    <% end %>
  </tbody>

  <tfoot>
    <tr>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td><%= link_to 'Checkout All', serves_checkout_all_path, method: :post, data: { confirm: 'Are you sure?' }, class: "btn btn-danger btn-block" %></td>
    </tr>
  </tfoot>
  
</table>